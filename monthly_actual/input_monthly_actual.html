<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>概算実績入力</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        .icon-small {
            font-size: 0.7rem;
            /* アイコンサイズを小さくする */
            line-height: 1;
            /* ボタン内でアイコンを中央に揃える */
        }

        .btn-icon {
            padding: 0.2rem;
            /* ボタンのパディングを縮小 */
            width: 1rem;
            /* ボタンの幅を調整 */
            height: 1rem;
            /* ボタンの高さを調整 */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* テキストボックス幅調整 */
        input[type="number"] {
            width: 100%;
            /* テキストボックスをセル幅一杯に */
            box-sizing: border-box;
            /* パディングも幅に含める */
            text-align: right;
            /* 入力欄の右寄せ */
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg bg-primary p-0" data-bs-theme="dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">採算表</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            CP
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">2020</a></li>
                            <li><a class="dropdown-item" href="#">2021</a></li>
                            <li><a class="dropdown-item" href="#">2022</a></li>
                            <li><a class="dropdown-item" href="#">2023</a></li>
                            <li><a class="dropdown-item" href="#">2024</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            見通し
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            予定
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            月末見込み
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            概算
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <div class="navbar-nav ms-auto">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bi bi-person-fill"></i>&nbsp;
                            user name さん
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid mt-3">
        <h3>FY25_11月概算実績入力</h3>
        <table class="table table-hover table-bordered table-sm">
            <thead>
                <tr>
                    <th style="width: 200px;">勘定科目/詳細</th>
                    <th class="text-center" style="width: 100px;">CP</th>
                    <th class="text-center" style="width: 100px;">予定</th>
                    <th class="text-center" style="width: 100px;">月末見込み</th>
                    <th class="text-center" style="width: 100px;">実績</th>
                </tr>
            </thead>
            <tbody>
                <!-- Parent Row: 雑給 -->
                <tr>
                    <td>
                        <button class="btn btn-sm btn-light btn-icon toggle-icon" data-bs-toggle="collapse"
                            data-bs-target="#child1">
                            <i class="bi bi-dash icon-small"></i>
                        </button>
                        雑給
                    </td>
                    <td class="text-end" id="total-zatsukyu">0</td>
                </tr>
                <!-- Child Rows: 派遣A -->
                <tr class="collapse show" id="child1">
                    <td class="ps-4">派遣A</td>
                    <td class="text-end" id="total-hakenA">0</td>
                </tr>
                <tr class="collapse show" id="child1">
                    <td class="ps-5">係名（A）</td>
                    <td>
                        <input class="form-control form-control-sm input-value" type="number" data-parent="hakenA"
                            data-grandparent="zatsukyu" value="">
                    </td>
                </tr>
                <tr class="collapse show" id="child1">
                    <td class="ps-5">係名（B）</td>
                    <td>
                        <input class="form-control form-control-sm input-value" type="number" data-parent="hakenA"
                            data-grandparent="zatsukyu" value="">
                    </td>
                </tr>
                <!-- Child Rows: 派遣B -->
                <tr class="collapse show" id="child1">
                    <td class="ps-4">派遣B</td>
                    <td class="text-end" id="total-hakenB">0</td>
                </tr>
                <tr class="collapse show" id="child1">
                    <td class="ps-5">係名（A）</td>
                    <td>
                        <input class="form-control form-control-sm input-value" type="number" data-parent="hakenB"
                            data-grandparent="zatsukyu" value="">
                    </td>
                </tr>
                <tr class="collapse show" id="child1">
                    <td class="ps-5">係名（B）</td>
                    <td>
                        <input class="form-control form-control-sm input-value" type="number" data-parent="hakenB"
                            data-grandparent="zatsukyu" value="">
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toggle Bootstrap Icons dynamically
        document.querySelectorAll('.toggle-icon').forEach(button => {
            button.addEventListener('click', () => {
                const icon = button.querySelector('i');
                if (icon.classList.contains('bi-plus')) {
                    icon.classList.remove('bi-plus');
                    icon.classList.add('bi-dash');

                } else {
                    icon.classList.remove('bi-dash');
                    icon.classList.add('bi-plus');

                }
            });

        });
    </script>
    <script>
        // Update totals dynamically
        function updateTotals() {
            const parentTotals = {}; // Track parent totals (e.g., hakenA, hakenB)
            const grandParentTotals = {}; // Track grandparent totals (e.g., zatsukyu)

            document.querySelectorAll('.input-value').forEach(input => {
                const parent = input.dataset.parent;
                const grandparent = input.dataset.grandparent;
                const value = parseFloat(input.value) || 0;

                // Update parent totals
                if (!parentTotals[parent]) {
                    parentTotals[parent] = 0;
                }
                parentTotals[parent] += value;

                // Update grandparent totals
                if (!grandParentTotals[grandparent]) {
                    grandParentTotals[grandparent] = 0;
                }
                grandParentTotals[grandparent] += value;
            });

            // Update parent total cells
            for (const [parent, total] of Object.entries(parentTotals)) {
                const totalCell = document.getElementById(`total-${parent}`);
                if (totalCell) {
                    totalCell.textContent = total.toLocaleString(); // Format as number
                }
            }

            // Update grandparent total cells
            for (const [grandparent, total] of Object.entries(grandParentTotals)) {
                const totalCell = document.getElementById(`total-${grandparent}`);
                if (totalCell) {
                    totalCell.textContent = total.toLocaleString(); // Format as number
                }
            }
        }

        // Add event listeners to input fields
        document.querySelectorAll('.input-value').forEach(input => {
            input.addEventListener('input', updateTotals);
        });
    </script>
</body>

</html>